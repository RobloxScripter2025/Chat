<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin Panel</title>
<style>
body{font-family:Inter,system-ui;background:#070607;color:#ddd;padding:18px}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border:1px solid #333}
button{background:#8b5cf6;color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer}
.inputRow{display:flex;gap:8px;margin-bottom:12px}
</style>
</head>
<body>
  <h2>Admin Panel</h2>

  <div class="inputRow">
    <input id="adminPassword" type="password" placeholder="Admin password" />
    <input id="banUserId" placeholder="UserID to ban (e.g. skt_xxx)" />
    <input id="banReason" placeholder="Reason (optional)" />
    <button id="banBtn">Ban by UserID</button>
  </div>

  <h3>Current bans</h3>
  <table id="bansTable">
    <tr><th>#</th><th>Username</th><th>Cookie/UserID</th><th>Reason</th><th>Action</th></tr>
  </table>

<script>
  async function loadBans() {
    const res = await fetch('/bans.json');
    const bans = await res.json();
    const table = document.getElementById('bansTable');
    // clear rows (except header)
    table.querySelectorAll('tr:not(:first-child)').forEach(r => r.remove());
    bans.forEach((b, i) => {
      const row = table.insertRow();
      row.innerHTML = `<td>${i}</td>
        <td>${b.username}</td><td>${b.cookie}</td><td>${b.reason}</td>
        <td><button onclick="unban(${i})">Unban</button></td>`;
    });
  }

  async function unban(index) {
    const password = document.getElementById('adminPassword').value;
    if (!password) return alert('Enter admin password');
    const res = await fetch(`/unban/${index}`, {
      method:'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ password })
    });
    if (res.ok) {
      alert('Unbanned');
      loadBans();
    } else {
      alert('Wrong password or error');
    }
  }

  // Ban by userid (admin)
  document.getElementById('banBtn').onclick = async () => {
    const password = document.getElementById('adminPassword').value;
    const userid = document.getElementById('banUserId').value.trim();
    const reason = document.getElementById('banReason').value.trim();
    if (!password) return alert('Enter admin password');
    if (!userid) return alert('Enter user id to ban');
    const res = await fetch('/ban/userid', {
      method:'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ password, userid, reason })
    });
    if (res.ok) {
      alert('User banned');
      loadBans();
    } else {
      const text = await res.text();
      alert('Error: ' + text);
    }
  };

  // initial load
  loadBans();
</script>
</body>
</html>
